<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è²¯é‡‘ç®±ãƒ­ã‚°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰</title>
  <style>
    :root { --card:#fff; --muted:#667085; --accent:#1e90ff; --red:#ff5a5a; }
    body { margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Sans","Yu Gothic UI","YuGothic",Meiryo,sans-serif; background:#f6f8fb; color:#222; padding:16px; }
    .wrap { max-width:720px; margin:0 auto; }
    .card { background:var(--card); border-radius:14px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.06); border:1px solid rgba(0,0,0,.05); }
    h1 { font-size:20px; margin:0 0 6px; }
    .muted{ color:var(--muted); font-size:12px; }
    .total { text-align:center; margin:10px 0 14px; }
    .yen { font-size:40px; font-weight:800; }
    .form { display:flex; gap:8px; flex-wrap:wrap; align-items:flex-end; margin:8px 0 12px; }
    .field { display:flex; flex-direction:column; gap:6px; }
    label { font-size:12px; color:#475569; }
    input[type="number"], input[type="text"] { border:1px solid #dbe3eb; border-radius:10px; padding:10px 12px; font-size:16px; min-width:120px; outline:none; }
    input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(30,144,255,.2); }
    .btn { border:none; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer; }
    .btn-add { background:var(--accent); color:#fff; }
    .btn-sub { background:var(--red); color:#fff; }
    .btn-undo, .btn-export, .btn-import { background:#eef3f8; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    .log { margin-top:8px; border:1px solid #e9eef4; border-radius:12px; overflow:hidden; background:#fff; }
    .log-header{ display:flex; justify-content:space-between; padding:10px 14px; background:#f3f7fb; font-weight:700; font-size:13px; color:#334155; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:10px 12px; border-bottom:1px solid #eef2f7; font-size:14px; }
    th { background:#fbfdff; text-align:left; color:#475569; }
    td.amount{ text-align:right; font-variant-numeric:tabular-nums; width:120px;}
    .pos{ color:#0f9d58; font-weight:700; } .neg{ color:#d93025; font-weight:700; }
    .pill{ padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:12px; font-weight:700;}
    footer{ text-align:center; font-size:12px; color:#94a3b8; margin-top:10px;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>è²¯é‡‘ç®±ãƒ­ã‚°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰</h1>
      <div class="muted">â€» ç”»é¢å†…ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ› â†’ ã€Œè²¯é‡‘/å‡ºé‡‘ã€ã§è¨˜éŒ²ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
      <div class="total">
        <div class="muted">ä»Šã®ç·é¡</div>
        <div class="yen" id="total">Â¥0</div>
      </div>
      <div class="form">
        <div class="field">
          <label for="amount">é‡‘é¡ï¼ˆå††ï¼‰</label>
          <input id="amount" type="number" inputmode="numeric" min="1" step="1" placeholder="ä¾‹ï¼š500">
        </div>
        <div class="field" style="flex:1 1 240px;">
          <label for="memo">ãƒ¡ãƒ¢</label>
          <input id="memo" type="text" maxlength="60" placeholder="ä¾‹ï¼šé£²ã¿ã‚¼ãƒ­é”æˆ / ã‚«ãƒ•ã‚§æˆ‘æ…¢">
        </div>
        <button class="btn btn-add" id="btnDeposit">è²¯é‡‘</button>
        <button class="btn btn-sub" id="btnWithdraw">å‡ºé‡‘</button>
      </div>
      <div class="actions" style="justify-content:flex-end; margin-bottom:6px;">
        <button class="btn btn-undo" id="btnUndo">å…ƒã«æˆ»ã™</button>
        <button class="btn btn-export" id="btnExport">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
        <label class="btn btn-import" for="importFile" style="cursor:pointer;">å¾©å…ƒ</label>
        <input id="importFile" type="file" accept="application/json" style="display:none;">
      </div>
      <div class="log">
        <div class="log-header">
          <span>ğŸ“œ ä»Šã¾ã§ã®ãƒ­ã‚°</span>
          <span class="pill" id="countPill">0 ä»¶</span>
        </div>
        <div id="logTable"></div>
      </div>
      <footer>ä¿å­˜å…ˆï¼šã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆlocalStorageï¼‰ã€‚åˆ¥ç«¯æœ«ã§ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/å¾©å…ƒã‚’ä½¿ã£ã¦ã­ã€‚</footer>
    </div>
  </div>
  <script>
    const KEY="piggybank_entries_v1"; const state={lastAction:null};
    const load=()=>{try{const r=localStorage.getItem(KEY);return r?JSON.parse(r):[]}catch(e){return[]}};
    const save=e=>localStorage.setItem(KEY,JSON.stringify(e));
    const jpy=n=>new Intl.NumberFormat('ja-JP',{style:'currency',currency:'JPY',maximumFractionDigits:0}).format(n);
    const ymd=t=>{const d=new Date(t),p=n=>('0'+n).slice(-2);return `${d.getFullYear()}/${p(d.getMonth()+1)}/${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`};
    const totalOf=e=>e.reduce((s,x)=>s+x.amount,0);
    function render(){const es=load();total.textContent=jpy(totalOf(es));countPill.textContent=`${es.length} ä»¶`;
      if(es.length===0){logTable.innerHTML=`<div style="padding:16px; text-align:center; color:#667085;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;return;}
      let h=`<table><thead><tr><th style="width:150px;">æ—¥æ™‚</th><th>ãƒ¡ãƒ¢</th><th class="amount">é‡‘é¡</th></tr></thead><tbody>`;
      for(let i=es.length-1;i>=0;i--){const e=es[i],cls=e.amount>=0?'pos':'neg',sign=e.amount>=0?'+':'';h+=`<tr><td>${ymd(e.date)}</td><td>${e.memo||'-'}</td><td class="amount ${cls}">${sign}${jpy(e.amount)}</td></tr>`}
      h+=`</tbody></table>`;logTable.innerHTML=h;
    }
    function add(sign){const v=parseInt(amount.value,10);if(!v||v<=0){alert('é‡‘é¡ã‚’å…¥ã‚Œã¦ã­');return;}
      const es=load();const id=(crypto.randomUUID?crypto.randomUUID():String(Date.now()+Math.random()));
      es.push({id,date:Date.now(),amount:(sign==='minus'?-Math.abs(v):Math.abs(v)),memo:(memo.value||'')});
      save(es);state.lastAction={type:'add',id};amount.value='';memo.value='';render();
    }
    function undo(){const la=state.lastAction;if(!la)return;const es=load();const i=es.findIndex(e=>e.id===la.id);if(i!==-1){es.splice(i,1);save(es);}state.lastAction=null;render();}
    btnDeposit.addEventListener('click',()=>add('plus')); btnWithdraw.addEventListener('click',()=>add('minus')); btnUndo.addEventListener('click',undo);
    btnExport.addEventListener('click',()=>{const data={version:1,exportedAt:new Date().toISOString(),entries:load()};
      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const a=document.createElement('a');
      a.href=URL.createObjectURL(blob); a.download=`piggybank-backup-${Date.now()}.json`; document.body.appendChild(a); a.click(); a.remove();
    });
    importFile.addEventListener('change',ev=>{const f=ev.target.files[0]; if(!f)return; const r=new FileReader();
      r.onload=()=>{try{const o=JSON.parse(r.result); if(!o.entries||!Array.isArray(o.entries)) throw 0; save(o.entries); state.lastAction=null; render(); alert('å¾©å…ƒã—ã¾ã—ãŸã€‚');}
      catch(e){alert('å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸã€‚');}}; r.readAsText(f,'utf-8');});
    render();
  </script>
</body>
</html>
